# Rootly Edge Connector Configuration
# Copy this file to config.yml and customize for your environment

app:
  name: "rootly-edge-connector"

rootly:
  api_url: "https://rec.rootly.com"  # Rootly Edge Connector API base URL (production: rec.rootly.com, staging: staging.rootly-ops.com)
  api_path: "/v1"                     # API path prefix (optional, default: /v1)
  api_key: "YOUR_REC_API_KEY"         # Set via REC_API_KEY environment variable or replace this (format: rec_xxxxx)

poller:
  polling_wait_interval_ms: 5000     # Polling interval in milliseconds (default: 5000)
  visibility_timeout_sec: 30         # How long events are invisible after being fetched (default: 30)
  max_number_of_messages: 10         # Max events to fetch per poll (default: 10)
  retry_on_error: true               # Retry on polling errors (default: true)
  retry_backoff: "exponential"       # Backoff strategy: "exponential" or "linear" (default: exponential)
  max_retries: 3                     # Max retry attempts before resetting (default: 3)

pool:
  max_number_of_workers: 10          # Maximum worker goroutines (default: 10)
  min_number_of_workers: 2           # Minimum worker goroutines (default: 2)
  queue_size: 1000                   # Event queue size (default: 1000)
  keep_alive_time_ms: 60000          # Worker keep-alive time (default: 60000)
  monitoring_period_ms: 30000        # Worker pool monitoring interval (default: 30000)

security:
  script_timeout: 300                # Default script timeout in seconds (default: 300)
  allowed_script_paths:              # Restrict script execution to these paths (empty = allow all)
    - /opt/rootly-edge-connector/scripts
    - /usr/local/bin
  global_env:                        # Environment variables available to all scripts
    ENVIRONMENT: "production"
    LOG_LEVEL: "info"

logging:
  level: "info"                      # Log level: trace, debug, info, warn, error (default: info)
  format: "json"                     # Log format: json, text, colored (default: text)
  output: "stdout"                   # Log output: stdout or file path (default: stdout)
                                     # Production: /var/log/rootly-edge-connector/connector.log

  # Log rotation settings (only used when output is a file path)
  max_size_mb: 100                   # Max log file size before rotation (default: 100)
  max_backups: 3                     # Number of old log files to retain (default: 3)
  max_age_days: 7                    # Max days to retain old logs (default: 7)
  compress: true                     # Compress rotated logs with gzip (default: true)
  local_time: false                  # Use local time for log filenames (default: false, uses UTC)

metrics:
  enabled: true                      # Enable Prometheus metrics endpoint (default: true)
  port: 9090                         # Metrics HTTP server port (default: 9090)
  path: "/metrics"                   # Metrics endpoint path (default: /metrics)
  labels:                            # Optional: Custom labels added to all metrics
    connector_id: "prod-us-east-1"   # Unique identifier for this connector instance
    environment: "production"        # Environment (e.g., production, staging, dev)
    region: "us-east-1"              # Geographic region or datacenter
    # Add any custom labels you need for Prometheus queries
